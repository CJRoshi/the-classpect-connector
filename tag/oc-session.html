<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>STERA - The Classpect Connector</title>
  <link rel="icon" type="image/png" href="../images/special/CCLogoRegular.png" />
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="../components/mobile.css">
  <script type="text/babel" src="../components/constants.js"></script>
  <script type="text/babel" src="../components/header.js"></script>
  <script type="text/babel" src="../components/searchbar.js"></script>
  <script type="text/babel" src="../components/footer.js"></script>
  <style>
    @font-face { font-family: 'Typostuck'; src: url('../fonts/TYPOSTUCK.ttf') format('truetype'); }
    .font-courier      { font-family: 'Courier New', monospace; }
    .font-courier-bold { font-family: 'Courier New', monospace; font-weight: bold; }
    .font-typostuck { font-family: 'Typostuck', 'Courier New', monospace; font-size: 1.25rem; font-weight: normal; }
    .font-typostuck-title { font-family: 'Typostuck', 'Courier New', monospace; font-size: 2.5rem; font-weight: normal; }
    .font-typostuck-header { font-family: 'Typostuck', 'Courier New', monospace; font-size: 1.75rem; font-weight: normal; }
    .homestuck-command { font-family: Verdana, Arial, sans-serif; font-weight: bold; font-size: 1.25rem; color: #000; }
    .homestuck-command-dark { font-family: Verdana, Arial, sans-serif; font-weight: bold; font-size: 1.25rem; color: #fff; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body, html { width: 100%; min-height: 100vh; font-family: 'Courier New', monospace; }

    .char-card { border-radius: 8px; border: 2px solid transparent; padding: 12px; background: rgba(255,255,255,0.45); transition: border-color 0.2s, background 0.2s; position: relative; }
    .char-card:hover { background: rgba(255,255,255,0.65); }
    .char-symbol { width: 40px; height: 40px; object-fit: contain; flex-shrink: 0; }

    .soul-swatch { display: inline-flex; align-items: center; gap: 6px; cursor: pointer; border-radius: 4px; padding: 2px 6px 2px 2px; transition: background 0.15s; user-select: none; }
    .soul-swatch:hover { background: rgba(0,0,0,0.08); }
    .soul-heart { font-size: 1.1rem; filter: drop-shadow(0 0 4px currentColor); transition: filter 0.2s; }
    .soul-swatch:hover .soul-heart { filter: drop-shadow(0 0 8px currentColor); }
    .soul-hex { font-family: 'Courier New', monospace; font-size: 0.7rem; opacity: 0.6; letter-spacing: 0.05em; }

    .text-swatch { display: inline-flex; align-items: center; gap: 6px; cursor: pointer; border-radius: 4px; padding: 2px 6px 2px 2px; transition: background 0.15s; user-select: none; }
    .text-swatch:hover { background: rgba(0,0,0,0.08); }
    .text-dot { width: 12px; height: 12px; border-radius: 50%; flex-shrink: 0; border: 1px solid rgba(0,0,0,0.15); }

    .dropdown-toggle { font-family: 'Courier New', monospace; font-size: 0.72rem; cursor: pointer; opacity: 0.55; user-select: none; transition: opacity 0.15s; display: inline-flex; align-items: center; gap: 3px; }
    .dropdown-toggle:hover { opacity: 0.9; }
    .dropdown-content { overflow: hidden; transition: max-height 0.3s ease, opacity 0.3s ease; }
    .dropdown-content.closed { max-height: 0; opacity: 0; }
    .dropdown-content.open { max-height: 300px; opacity: 1; }
    .dropdown-row { display: flex; align-items: center; gap: 6px; padding: 2px 0; font-family: 'Courier New', monospace; font-size: 0.75rem; color: #374151; }
    .dropdown-label { font-weight: bold; opacity: 0.6; min-width: 80px; font-size: 0.68rem; text-transform: uppercase; letter-spacing: 0.05em; }
    .dropdown-blank { color: #999; font-style: italic; }

    .ebony-toggle { position: absolute; top: 8px; right: 8px; font-family: 'Courier New', monospace; font-size: 0.62rem; cursor: pointer; opacity: 0.4; transition: opacity 0.2s; user-select: none; letter-spacing: 0.04em; border: 1px solid currentColor; padding: 1px 5px; border-radius: 3px; }
    .ebony-toggle:hover { opacity: 0.9; }

    .scratch-zone { display: flex; flex-direction: column; align-items: center; gap: 8px; margin: 20px 0; position: relative; }
    .fret-string { position: absolute; left: 0; right: 0; height: 1px; background: linear-gradient(90deg, transparent, rgba(100,80,50,0.35), rgba(160,130,80,0.65), rgba(100,80,50,0.35), transparent); }
    .fret-line { position: absolute; top: 0; bottom: 0; width: 2px; background: rgba(100,80,50,0.2); }

    .strum-btn { font-family: 'Typostuck', 'Courier New', monospace; font-size: 1.5rem; color: #2d1a00; background: linear-gradient(135deg, #c8a96e, #a07840, #c8a96e); border: 3px solid #7a5520; border-radius: 6px; padding: 8px 28px; cursor: pointer; letter-spacing: 0.05em; box-shadow: 0 3px 0 #5a3810, 0 4px 8px rgba(0,0,0,0.3); transition: transform 0.1s, box-shadow 0.1s, filter 0.15s; position: relative; z-index: 2; user-select: none; }
    .strum-btn:hover { filter: brightness(1.08); }
    .strum-btn.strumming { transform: translateY(3px); box-shadow: 0 0 0 #5a3810, 0 2px 4px rgba(0,0,0,0.3); }
    .strum-btn.post-scratch { background: linear-gradient(135deg, #6e8ac8, #405890, #6e8ac8); border-color: #203870; color: #e8f0ff; box-shadow: 0 3px 0 #102050, 0 4px 8px rgba(0,0,0,0.3); }
    .strum-btn.post-scratch.strumming { box-shadow: 0 0 0 #102050, 0 2px 4px rgba(0,0,0,0.3); }

    .section-label { font-family: 'Typostuck', 'Courier New', monospace; font-size: 0.8rem; letter-spacing: 0.15em; opacity: 0.45; }
    .ancestor-divider { display: flex; align-items: center; gap: 12px; margin: 16px 0 12px; }
    .ancestor-divider-line { flex: 1; height: 1px; background: #a0a0a0; }
    .ancestor-divider-text { font-family: 'Courier New', monospace; font-size: 0.7rem; letter-spacing: 0.1em; text-transform: uppercase; opacity: 0.5; white-space: nowrap; }

    .moon-prospit { color: #d4a800; }
    .moon-derse   { color: #8b3ec8; }

    .copy-toast { position: fixed; bottom: 24px; left: 50%; transform: translateX(-50%); background: #1a1a1a; color: #22c55e; font-family: 'Courier New', monospace; font-size: 0.8rem; padding: 6px 16px; border-radius: 4px; pointer-events: none; opacity: 0; transition: opacity 0.2s; z-index: 1000; }
    .copy-toast.visible { opacity: 1; }

    .session-content { transition: opacity 0.3s; }
    .session-content.fading { opacity: 0; }
  </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const defaultTheme = { bg:"#626262", contentBg:"#d0d0d0", textColor:"#000000", accentBg:"#a0a0a0", isDark:false };

const PRE_SCRATCH_PLAYERS = [
  { name:'Dawn Westwood', handle:'achromaticBlockbuster', classpect:['Sylph','Heart'], moon:'Prospit', textColor:'#999999', soul:{type:'DT',color:'#F30000'}, symbol:'../images/special/oc-symbols/Dawn_Symbol.png', land:'Land of Silver and Mending', strife:'flailkind', birthday:'Sep 28', type:'human', ebony:null },
  { name:'Jasão "Jace" Ferreiro', handle:'rushingEnchain', classpect:['Heir','Blood'], moon:'Derse', textColor:'#1B39E2', soul:{type:'INT',color:'#0000F3'}, symbol:'../images/special/oc-symbols/Jace_Symbol.png', land:'Land of Iron and Crowns', strife:'rapierkind, chiselkind, blowtrchkind', birthday:'Jun 15', type:'human', ebony:null },
  { name:'Nunki Aerwynn', handle:'obscuraTelos', classpect:['Maid','Space'], moon:'Derse', textColor:'#A24875', soul:{type:'PRS',color:'#8400F3'}, symbol:'../images/special/oc-symbols/Nunki_Symbol.png', land:'Land of Thorium and Frogs', strife:'broomkind, shockingkind', birthday:'Dec 12', type:'monster', ebony:null },
  { name:'Thorn Derosin', handle:'caprineCappuccino', classpect:['Mage','Time'], moon:'Prospit', textColor:'#1B7539', soul:{type:'BRV',color:'#F38400'}, symbol:'../images/special/oc-symbols/Thorn_Symbol.png', land:'Land of Cesium and Insight', strife:'2xanykind, flamingkind', birthday:'Jan 9', type:'monster',
    ebony:{ name:'Ebony Derosin', handle:'fracturedWildfire', classpect:['Mage','Time'], moon:'Derse', textColor:'#480C57', soul:null, symbol:'../images/special/oc-symbols/Ebony_Symbol.png', land:'Land of Cesium and Insight', strife:'corupflmkind, knuxkind', birthday:'"Jan 9" (technically, Nov 20)' } },
  { name:'Vérité Agtier', handle:'pestilentStrain', classpect:['Knight','Breath'], moon:'Prospit', textColor:'#2A6648', soul:{type:'KND',color:'#00E200'}, symbol:'../images/special/oc-symbols/virus.png', land:"Land of Gold and Shields", strife:'hckystckkind', birthday:'Sep 12', type:'troll', ebony:null },
  { name:'Aonara Kruxit', handle:'aeronauticRockstar', classpect:['Thief','Doom'], moon:'Derse', textColor:'#A2752A', soul:{type:'JST',color:'#F3F300'}, symbol:'../images/special/oc-symbols/taurmini.png', land:"Land of Lead and Locks", strife:"slngshotkind", birthday:'May 7', type:'troll', ebony:null },
];

const PRE_SCRATCH_ANCESTORS = [
  { name:'River Aquinas', title:'The Fountain', soul:{type:'DT',color:'#F30000'}, textColor:'#F30000', symbol:'../images/special/oc-symbols/River_Symbol.png', nameNote:null, titleNote:null },
  { name:'Imoita Kruxit', title:'The Reinlæss', soul:{type:'INT',color:'#0000F3'}, textColor:'#A2752A', symbol:'../images/special/oc-symbols/tauriborn.png', nameNote:'Born on Ekogaard. Fled.', titleNote:null },
  { name:'Amurex Vissen', title:'The Guardian Conserve', soul:{type:'PRS',color:'#8400F3'}, textColor:'#750039', symbol:'../images/special/oc-symbols/pisces.png', nameNote:'Born on Earth.', titleNote:'(in due time, His Impassioned Conservation)' },
  { name:'Hugo Méridien', title:'Le Sénateur', soul:{type:'BRV',color:'#F38400'}, textColor:'#00F3CC', symbol:'../images/special/oc-symbols/Hugo_Old_Symbol.png', nameNote:null, titleNote:'(The Senator, in French)' },
  { name:'Mags Octavian', title:'The Talewrit', soul:{type:'KND',color:'#00E200'}, textColor:'#005784', symbol:'../images/special/oc-symbols/Mags_Symbol.png', nameNote:null, titleNote:null },
  { name:'Demir Aequals', title:'The Emissary', soul:{type:'JST',color:'#F3F300'}, textColor:'#00A10C', symbol:'../images/special/oc-symbols/Demir_Symbol.png', nameNote:null, titleNote:null },
];

const POST_SCRATCH_PLAYERS = [
  { name:'Hugo Méridien', handle:'candorCoincidence', classpect:['Witch','Mind'], moon:'Prospit', textColor:'#00F3CC', soul:{type:'BRV',color:'#F38400'}, symbol:'../images/special/oc-symbols/Hugo_Symbol.png', land:'Land of Bismuth and Spires', strife:'1/2anykind', birthday:'Jul 17' },
  { name:'Maggie "Mags" Octavian', handle:'persnicketySleuth', classpect:['Bard','Light'], moon:'Prospit', textColor:'#005784', soul:{type:'KND',color:'#00E200'}, symbol:'../images/special/oc-symbols/Mags_Symbol.png', land:'Land of Phosphor and Globes', strife:'paddlekind, batkind', birthday:'Oct 31' },
  { name:'River Aquinas', handle:'affogatosBight', classpect:['Rogue','Hope'], moon:'Prospit', textColor:'#F30000', soul:{type:'DT',color:'#F30000'}, symbol:'../images/special/oc-symbols/River_Symbol.png', land:'Land of Neodymium and Guile', strife:'thrwstarkind, icykind', birthday:'Feb 14' },
  { name:'Demir Aequals', handle:'aimfulRhabdomancer', classpect:['Seer','Void'], moon:'Derse', textColor:'#00A10C', soul:{type:'JST',color:'#F3F300'}, symbol:'../images/special/oc-symbols/Demir_Symbol.png', land:'Land of Quicksilver and Crystal', strife:'fistkind, clawkind, rockykind', birthday:'Mar 21' },
  { name:'Amurex Vissen', handle:'oceanicTsundere', classpect:['Page','Life'], moon:'Derse', textColor:'#750039', soul:{type:'PRS',color:'#8400F3'}, symbol:'../images/special/oc-symbols/pisces.png', land:'Land of Carbon and Combat', strife:'2x3dentkind, harpoonkind', birthday:'Mar 9' },
  { name:'Imoita Kruxit', handle:'reinlessEccentric', classpect:['Prince','Rage'], moon:'Derse', textColor:'#A2752A', soul:{type:"INT",color:'#0000F3'}, symbol:'../images/special/oc-symbols/tauriborn.png', land:"Land of Brimstone and Basilisks", strife:"whipkind, riflekind", birthday:"May 7" },
];

const POST_SCRATCH_ANCESTORS = [
  { name:'Kozma Derosin', title:'Orarërës', soul:{type:'BRV',color:'#F38400'}, textColor:'#F38400', symbol:'../images/special/oc-symbols/Kozma_Symbol.png', nameNote:'His name in this timeline is Kozma, not Thorn.', titleNote:'(The Hourglass, in Albanian)' },
  { name:'Vérité Agtier', title:'La Chantrix', soul:{type:'KND',color:'#00E200'}, textColor:'#2A6648', symbol:'../images/special/oc-symbols/virus.png', nameNote:'Born on Ekogaard. Fled.', titleNote:'(The Songstress, in French)' },
  { name:'Dawn Westwood', title:'The Director', soul:{type:'DT',color:'#F30000'}, textColor:'#999999', symbol:'../images/special/oc-symbols/Dawn_Symbol.png', nameNote:null, titleNote:null },
  { name:'Aonara Kruxit', title:'An Sealgair', soul:{type:'JST',color:'#F3F300'}, textColor:'#A2752A', symbol:'../images/special/oc-symbols/taurmini.png', nameNote:'Born on Ekogaard. Fled.', titleNote:'(The Hunter, in Scots-Gaelic)' },
  { name:'Nunki Aerwynn', title:'The Picturer', soul:{type:'PRS',color:'#8400F3'}, textColor:'#A24875', symbol:'../images/special/oc-symbols/Nunki_Symbol.png', nameNote:null, titleNote:null },
  { name:'Jace Ferreiro', title:'O Restrito', soul:{type:"INT",color:'#0000F3'}, textColor:'#1B39E2', symbol:'../images/special/oc-symbols/Jace_Symbol.png', nameNote:null, titleNote:null },
];

// Darkens a hex color for display on light backgrounds when it's too bright
const darkenForDisplay = (hex) => {
  const r = parseInt(hex.slice(1,3),16);
  const g = parseInt(hex.slice(3,5),16);
  const b = parseInt(hex.slice(5,7),16);
  const lum = (0.299*r + 0.587*g + 0.114*b) / 255;
  if (lum <= 0.55) return hex; // fine as-is
  // Scale down to ~50% luminance
  const scale = 0.5 / lum;
  const dr = Math.round(r * scale);
  const dg = Math.round(g * scale);
  const db = Math.round(b * scale);
  return `#${dr.toString(16).padStart(2,'0')}${dg.toString(16).padStart(2,'0')}${db.toString(16).padStart(2,'0')}`;
};

const CopyToast = ({ message, visible }) => (
  <div className={`copy-toast${visible ? ' visible' : ''}`}>{message}</div>
);

const SoulSwatch = ({ soul, onCopy }) => {
  if (!soul) return null;
  return (
    <div className="soul-swatch" onClick={() => onCopy(soul.color)} title={`${soul.type} SOUL — click to copy`}>
      <span className="soul-heart" style={{ color: soul.color }}>♥</span>
      <span style={{ fontFamily:'Courier New,monospace', fontSize:'0.75rem', color:'#374151' }}>{soul.type}</span>
      <span className="soul-hex">{soul.color}</span>
    </div>
  );
};

const TextColorSwatch = ({ color, onCopy }) => (
  <div className="text-swatch" onClick={() => onCopy(color)} title="Text color — click to copy">
    <div className="text-dot" style={{ background: color }}/>
    <span style={{ fontFamily:'Courier New,monospace', fontSize:'0.72rem', color:'#374151' }}>text</span>
    <span className="soul-hex">{color}</span>
  </div>
);

const MoonIcon = ({ moon }) => (
  <img
    src={moon === 'Prospit' ? '../images/special/prospit_bg.png' : '../images/special/derse_bg.png'}
    title={moon}
    alt={moon}
    style={{ width:'18px', height:'18px', objectFit:'contain', display:'inline-block', verticalAlign:'middle', flexShrink:0 }}
  />
);

const DropdownInfo = ({ char, onCopy }) => {
  const [open, setOpen] = React.useState(false);
  return (
    <div style={{ marginTop:'6px' }}>
      <span className="dropdown-toggle" onClick={() => setOpen(o => !o)}>
        <span>{open ? '▾' : '▸'}</span><span>Details</span>
      </span>
      <div className={`dropdown-content ${open ? 'open' : 'closed'}`}>
        <div style={{ marginTop:'6px', paddingLeft:'8px', borderLeft:'2px solid rgba(0,0,0,0.1)' }}>
          {char.soul && (
            <div className="dropdown-row">
              <span className="dropdown-label">SOUL</span>
              <SoulSwatch soul={char.soul} onCopy={onCopy}/>
            </div>
          )}
          <div className="dropdown-row">
            <span className="dropdown-label">TEXT</span>
            <TextColorSwatch color={char.textColor} onCopy={onCopy}/>
          </div>
          {char.handle && (
            <div className="dropdown-row">
              <span className="dropdown-label">HANDLE</span>
              <span style={{ fontFamily:'Courier New,monospace', fontSize:'0.75rem' }}>{char.handle}</span>
            </div>
          )}
          {char.moon && (
            <div className="dropdown-row">
              <span className="dropdown-label">DREAM MOON</span>
              <span style={{ display:'flex', alignItems:'center', gap:4 }}>
                <MoonIcon moon={char.moon}/>
                <span style={{ fontFamily:'Courier New,monospace', fontSize:'0.75rem' }}>{char.moon}</span>
              </span>
            </div>
          )}
          <div className="dropdown-row">
            <span className="dropdown-label">LAND</span>
            {char.land ? <span style={{ fontFamily:'Courier New,monospace', fontSize:'0.75rem' }}>{char.land}</span> : <span className="dropdown-blank">—</span>}
          </div>
          <div className="dropdown-row">
            <span className="dropdown-label">STRIFE</span>
            {char.strife ? <span style={{ fontFamily:'Courier New,monospace', fontSize:'0.75rem' }}>{char.strife}</span> : <span className="dropdown-blank">—</span>}
          </div>
          <div className="dropdown-row">
            <span className="dropdown-label">BIRTHDAY</span>
            {char.birthday ? <span style={{ fontFamily:'Courier New,monospace', fontSize:'0.75rem' }}>{char.birthday}</span> : <span className="dropdown-blank">—</span>}
          </div>
        </div>
      </div>
    </div>
  );
};

const PlayerCard = ({ char, isPost, onCopy }) => {
  const [showEbony, setShowEbony] = React.useState(false);
  const display = showEbony ? char.ebony : char;
  const [cls, asp] = display.classpect;
  const path = `../index.html#/classpect/${cls.toLowerCase()}-of-${asp.toLowerCase()}`;
  const canToggle = !!char.ebony && !isPost;

  return (
    <div className="char-card" style={{ borderColor: display.textColor + '66' }}>
      {canToggle && (
        <span className="ebony-toggle" style={{ color: showEbony ? '#480C57' : '#1B7539' }}
          onClick={() => setShowEbony(e => !e)}>
          {showEbony ? '← Thorn' : 'Ebony →'}
        </span>
      )}
      <div className="flex items-start gap-3">
        <img src={display.symbol} className="char-symbol" alt=""
          style={{ filter:`drop-shadow(0 0 4px ${display.textColor}55)` }}/>
        <div style={{ flex:1, minWidth:0 }}>
          <div className="flex items-center gap-2 flex-wrap">
            <span className="font-courier-bold" style={{ color:darkenForDisplay(display.textColor), fontSize:'1.0rem' }}>
              {display.name}
            </span>
            {display.moon && <MoonIcon moon={display.moon}/>}
          </div>
          <a href={path} className="font-courier-bold hover:underline"
            style={{ color:'#0000ee', textDecoration:'none', fontSize:'0.9rem', display:'block' }}>
            {cls} of {asp}
          </a>
          <DropdownInfo char={display} onCopy={onCopy}/>
        </div>
      </div>
    </div>
  );
};

const AncestorCard = ({ anc, onCopy }) => (
  <div className="char-card" style={{ borderColor: anc.textColor + '44', background:'rgba(255,255,255,0.3)' }}>
    <div className="flex items-start gap-3">
      <img src={anc.symbol} className="char-symbol" alt=""
        style={{ filter:`drop-shadow(0 0 4px ${anc.textColor}44)`, opacity:0.8 }}/>
      <div style={{ flex:1, minWidth:0 }}>
        <span className="font-courier-bold" style={{ color:darkenForDisplay(anc.textColor), fontSize:'0.95rem' }}>
          {anc.title}
        </span>
        {anc.titleNote && (
          <span style={{ fontFamily:'Courier New,monospace', fontSize:'0.72rem', color:'#666', fontStyle:'italic' }}>
            {' '}{anc.titleNote}
          </span>
        )}
        <div style={{ fontFamily:'Courier New,monospace', fontSize:'0.78rem', color:'#555', fontStyle:'italic' }}>
          {anc.name}
        </div>
        {anc.nameNote && (
          <div style={{ fontFamily:'Courier New,monospace', fontSize:'0.7rem', color:'#777', marginTop:2 }}>
            {anc.nameNote}
          </div>
        )}
        <div style={{ marginTop:4 }}>
          <SoulSwatch soul={anc.soul} onCopy={onCopy}/>
        </div>
        <TextColorSwatch color={anc.textColor} onCopy={onCopy}/>
      </div>
    </div>
  </div>
);

const Fretboard = ({ isPost, onStrum, strumming }) => {
  const strings = [14,24,34,44,54,64];
  const frets   = [12,24,36,48,62,76,90];
  return (
    <div className="scratch-zone">
      <div className="section-label">{isPost ? '◆ POST-SCRATCH | STERA v0.5 ◆' : '◆ PRE-SCRATCH | STERA v2.0 ◆'}</div>
      <div style={{ position:'relative', width:'100%', height:'80px' }}>
        {frets.map((p,i) => <div key={i} className="fret-line" style={{ left:`${p}%` }}/>)}
        {strings.map((p,i) => <div key={i} className="fret-string" style={{ top:`${p}%` }}/>)}
        <div style={{ position:'absolute', inset:0, display:'flex', alignItems:'center', justifyContent:'center' }}>
          <button className={`strum-btn${isPost?' post-scratch':''}${strumming?' strumming':''}`} onClick={onStrum}>
            {isPost ? '> UNSTRUM' : '> STRUM'}
          </button>
        </div>
      </div>
      <div style={{ fontFamily:'Courier New,monospace', fontSize:'0.7rem', opacity:0.4, letterSpacing:'0.08em' }}>
        {isPost ? 'Return to a world you believed abandoned.' : 'Scratch the Surface.'}
      </div>
    </div>
  );
};

const SessionPage = () => {
  const [isPost, setIsPost]       = React.useState(false);
  const [fading, setFading]       = React.useState(false);
  const [strumming, setStrumming] = React.useState(false);
  const [toast, setToast]         = React.useState({ visible:false, msg:'' });
  const [muted, setMuted]         = React.useState(false);
  const handleNavigate = path => { window.location.href = `../index.html#${path}`; };

  const playSound = (name) => {
    if (muted) return;
    const a = new Audio(`../snd/${name}.wav`);
    a.volume = 0.75;
    a.play().catch(() => {}); // swallow autoplay policy errors silently
  };

  const handleStrum = () => {
    playSound(isPost ? 'wipe' : 'strum');
    setStrumming(true); setFading(true);
    setTimeout(() => { setIsPost(p => !p); setFading(false); setStrumming(false); }, 320);
  };

  const handleCopy = hex => {
    navigator.clipboard.writeText(hex).then(() => {
      setToast({ visible:true, msg:`copied ${hex}` });
      setTimeout(() => setToast(t => ({ ...t, visible:false })), 1800);
    });
  };

  const players   = isPost ? POST_SCRATCH_PLAYERS   : PRE_SCRATCH_PLAYERS;
  const ancestors = isPost ? POST_SCRATCH_ANCESTORS : PRE_SCRATCH_ANCESTORS;

  return (
    <div style={{ backgroundColor:defaultTheme.bg, minHeight:'100vh' }}>
      <Header onNavigate={handleNavigate} theme={defaultTheme}/>
      <div className="px-3 sm:px-6"><div className="max-w-4xl mx-auto">
        <SearchBar onNavigate={handleNavigate} theme={defaultTheme}/>
      </div></div>
      <div className="px-3 sm:px-6 pb-6"><div className="max-w-4xl mx-auto">
        <div className="content-box-mobile" style={{ backgroundColor:defaultTheme.contentBg, color:defaultTheme.textColor, padding:'24px', borderRadius:'8px', boxShadow:'0 4px 6px rgba(0,0,0,0.3)', border:`2px solid ${defaultTheme.accentBg}` }}>
          <div className="text-center mb-2">
            <h1 className="font-typostuck-title mb-1">Counterquest</h1>
            <p className="font-courier italic" style={{ fontSize:'0.85rem', color:'#6b7280' }}>
            Wherein one finds that, in running counter to the quest, there often lies an alternate path.
            </p>
          </div>

          <Fretboard isPost={isPost} onStrum={handleStrum} strumming={strumming}/>

          <div className={`session-content${fading?' fading':''}`}>
            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 mb-4">
              {players.map(char => (
                <PlayerCard key={char.name+(isPost?'-post':'-pre')} char={char} isPost={isPost} onCopy={handleCopy}/>
              ))}
            </div>

            <div className="ancestor-divider">
              <div className="ancestor-divider-line"/>
              <div className="ancestor-divider-text">{isPost ? 'post-scratch ancestors' : 'pre-scratch ancestors'}</div>
              <div className="ancestor-divider-line"/>
            </div>

            <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
              {ancestors.map(anc => (
                <AncestorCard key={anc.name+(isPost?'-post':'-pre')} anc={anc} onCopy={handleCopy}/>
              ))}
            </div>
          </div>
        </div>
        <Footer theme={defaultTheme}/>
      </div></div>
      <CopyToast message={toast.msg} visible={toast.visible}/>

      {/* Mute toggle — unobtrusive fixed corner button */}
      <button
        onClick={() => setMuted(m => !m)}
        title={muted ? 'Sound is off — click to unmute' : 'Sound is on — click to mute'}
        style={{
          position:'fixed', bottom:'24px', right:'16px', zIndex:200,
          fontFamily:'Courier New,monospace', fontSize:'0.65rem',
          cursor:'pointer', userSelect:'none', letterSpacing:'0.05em',
          border:'1px solid #555', padding:'2px 7px', borderRadius:'3px',
          background:'rgba(255,255,255,0.78)', color:'#333',
          opacity: muted ? 0.75 : 0.35,
          transition:'opacity 0.2s',
        }}
      >
        {muted ? 'SND OFF' : 'SND ON'}
      </button>
    </div>
  );
};

const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(<SessionPage/>);
</script>
</body>
</html>
